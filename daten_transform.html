<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Andreas Fischeneder">
<title>3&nbsp; Daten aufbereiten – Einführung in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./daten_import.html" rel="next">
<link href="./best_practices.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e7b690381a3be0915745ffc2579c22f1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><script src="site_libs/kePrint-0.0.1/kePrint.js"></script><link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./daten_transform.html">Datenaufbereitung</a></li><li class="breadcrumb-item"><a href="./daten_transform.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Daten aufbereiten</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Einführung in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Willkommen</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Grundlagen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./erste_schritte.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Erste Schritte in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./best_practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Best Practices</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Datenaufbereitung</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./daten_transform.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Daten aufbereiten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./daten_import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Daten importieren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./daten_export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Daten exportieren</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Datenvisualisierung</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualisierung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Grafiken in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistik in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./deskript_statistik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Deskriptive Statistiken</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regressionen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regressionen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kausalinferenz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Kausalinferenz</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Export von Ergebnissen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tab_export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Tabellen exportieren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fig_export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Grafiken exportieren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Berichte in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Weitere Themen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loops_funktionen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Loops und eigene Funktionen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ki.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">KI-Unterstützung in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./referenzen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literatur &amp; Ressourcen</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li><a href="#dplyr" id="toc-dplyr" class="nav-link active" data-scroll-target="#dplyr"><span class="header-section-number">3.1</span> Dplyr</a></li>
  <li><a href="#tidy-data-sets" id="toc-tidy-data-sets" class="nav-link" data-scroll-target="#tidy-data-sets"><span class="header-section-number">3.2</span> Tidy Data Sets</a></li>
  <li>
<a href="#daten-ausw%C3%A4hlen-und-sortieren" id="toc-daten-auswählen-und-sortieren" class="nav-link" data-scroll-target="#daten-ausw%C3%A4hlen-und-sortieren"><span class="header-section-number">3.3</span> Daten auswählen und sortieren</a>
  <ul class="collapse">
<li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span class="header-section-number">3.3.1</span> select()</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="header-section-number">3.3.2</span> filter()</a></li>
  <li><a href="#slice" id="toc-slice" class="nav-link" data-scroll-target="#slice"><span class="header-section-number">3.3.3</span> slice()</a></li>
  <li><a href="#distinct" id="toc-distinct" class="nav-link" data-scroll-target="#distinct"><span class="header-section-number">3.3.4</span> distinct()</a></li>
  <li><a href="#drop_na" id="toc-drop_na" class="nav-link" data-scroll-target="#drop_na"><span class="header-section-number">3.3.5</span> drop_na()</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">3.3.6</span> arrange()</a></li>
  </ul>
</li>
  <li>
<a href="#variablen-ver%C3%A4ndern-und-erstellen" id="toc-variablen-verändern-und-erstellen" class="nav-link" data-scroll-target="#variablen-ver%C3%A4ndern-und-erstellen"><span class="header-section-number">3.4</span> Variablen verändern und erstellen</a>
  <ul class="collapse">
<li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">3.4.1</span> mutate()</a></li>
  <li><a href="#if_else-case_when-replace_when" id="toc-if_else-case_when-replace_when" class="nav-link" data-scroll-target="#if_else-case_when-replace_when"><span class="header-section-number">3.4.2</span> if_else(), case_when() &amp; replace_when()</a></li>
  <li><a href="#recode_values-replace_values" id="toc-recode_values-replace_values" class="nav-link" data-scroll-target="#recode_values-replace_values"><span class="header-section-number">3.4.3</span> recode_values() &amp; replace_values()</a></li>
  </ul>
</li>
  <li>
<a href="#gruppieren-und-zusammenfassen" id="toc-gruppieren-und-zusammenfassen" class="nav-link" data-scroll-target="#gruppieren-und-zusammenfassen"><span class="header-section-number">3.5</span> Gruppieren und Zusammenfassen</a>
  <ul class="collapse">
<li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="header-section-number">3.5.1</span> group_by()</a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><span class="header-section-number">3.5.2</span> summarize()</a></li>
  <li><a href="#count" id="toc-count" class="nav-link" data-scroll-target="#count"><span class="header-section-number">3.5.3</span> count()</a></li>
  </ul>
</li>
  <li>
<a href="#datens%C3%A4tze-zusammenf%C3%BChren" id="toc-datensätze-zusammenführen" class="nav-link" data-scroll-target="#datens%C3%A4tze-zusammenf%C3%BChren"><span class="header-section-number">3.6</span> Datensätze zusammenführen</a>
  <ul class="collapse">
<li><a href="#bind_rows-bind_cols" id="toc-bind_rows-bind_cols" class="nav-link" data-scroll-target="#bind_rows-bind_cols"><span class="header-section-number">3.6.1</span> bind_rows() &amp; bind_cols()</a></li>
  <li><a href="#inner_join-left_join-full_join" id="toc-inner_join-left_join-full_join" class="nav-link" data-scroll-target="#inner_join-left_join-full_join"><span class="header-section-number">3.6.2</span> inner_join(), left_join(), full_join()</a></li>
  </ul>
</li>
  <li>
<a href="#datensatz-umformen" id="toc-datensatz-umformen" class="nav-link" data-scroll-target="#datensatz-umformen"><span class="header-section-number">3.7</span> Datensatz umformen</a>
  <ul class="collapse">
<li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><span class="header-section-number">3.7.1</span> pivot_longer()</a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><span class="header-section-number">3.7.2</span> pivot_wider()</a></li>
  </ul>
</li>
  <li>
<a href="#weitere-themen" id="toc-weitere-themen" class="nav-link" data-scroll-target="#weitere-themen"><span class="header-section-number">3.8</span> Weitere Themen</a>
  <ul class="collapse">
<li><a href="#strings-und-regular-expressions" id="toc-strings-und-regular-expressions" class="nav-link" data-scroll-target="#strings-und-regular-expressions"><span class="header-section-number">3.8.1</span> Strings und Regular Expressions</a></li>
  <li><a href="#datum-und-zeit" id="toc-datum-und-zeit" class="nav-link" data-scroll-target="#datum-und-zeit"><span class="header-section-number">3.8.2</span> Datum und Zeit</a></li>
  <li><a href="#fehlende-werte" id="toc-fehlende-werte" class="nav-link" data-scroll-target="#fehlende-werte"><span class="header-section-number">3.8.3</span> Fehlende Werte</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./daten_transform.html">Datenaufbereitung</a></li><li class="breadcrumb-item"><a href="./daten_transform.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Daten aufbereiten</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-daten-transform" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Daten aufbereiten</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Datensätze liegen häufig nicht in der Form vor, die für Analyse oder Visualisierung benötigt wird. Daher müssen wir sie meist zunächst aufbereiten. Dazu gehört, relevante Variablen auszuwählen, Beobachtungen zu filtern, Datentypen zu korrigieren, neue Kennzahlen zu berechnen oder Informationen sinnvoll zusammenzufassen. Um diese Schritte zu illustrieren, verwenden wir den Palmer Penguins-Datensatz, der über das Package <code>palmerpenguins</code> frei verfügbar ist:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>    bill_len <span class="op">=</span> <span class="va">bill_length_mm</span>,</span>
<span>    bill_dep <span class="op">=</span> <span class="va">bill_depth_mm</span>,</span>
<span>    flipper_len <span class="op">=</span> <span class="va">flipper_length_mm</span>,</span>
<span>    body_mass <span class="op">=</span> <span class="va">body_mass_g</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">penguins</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Der <code>penguins</code> Datensatz enthält Informationen zu 344 Pinguinen mit den folgenden acht Variablen:</p>
<div class="cell">
<div id="tbl-penguins-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-penguins-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;3.1: Variablen im penguins-Datensatz
</figcaption><div aria-describedby="tbl-penguins-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Beschreibung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">species</td>
<td style="text-align: left;">Spezies des Pinguins (Adelie, Chinstrap, Gentoo)</td>
</tr>
<tr class="even">
<td style="text-align: left;">island</td>
<td style="text-align: left;">Insel, auf der der Pinguin beobachtet wurde (Biscoe, Dream, Torgersen)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bill_len</td>
<td style="text-align: left;">Schnabellänge in Millimetern</td>
</tr>
<tr class="even">
<td style="text-align: left;">bill_dep</td>
<td style="text-align: left;">Schnabeltiefe in Millimetern</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flipper_len</td>
<td style="text-align: left;">Flügellänge in Millimetern</td>
</tr>
<tr class="even">
<td style="text-align: left;">body_mass</td>
<td style="text-align: left;">Körpergewicht in Gramm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: left;">Geschlecht</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: left;">Jahr der Beobachtung</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<section id="dplyr" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="dplyr">
<span class="header-section-number">3.1</span> Dplyr</h2>
<p>Zur Datenmanipulation verwenden wir das <code>dplyr</code> Package, das Teil von <code>tidyverse</code> ist. In diesem Kapitel lernen wir die wichtigsten <code>dplyr</code>-Funktionen kennen. Für eine ausführliche Einführung siehe Kapitel 3, 5 und 12–19 in <a href="https://r4ds.hadley.nz">R for Data Science</a>. Alle <code>dplyr</code>-Funktionen nehmen einen Datensatz (Data Frame oder Tibble) als erstes Argument, führen die gewünschte Operation aus und geben einen neuen Datensatz zurück. Solltest du das <code>tidyverse</code> noch nicht geladen haben, lade es mit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Pipes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Komplexe Transformationen erfordern oft, mehrere <code>dplyr</code>-Funktionen zu kombinieren. Beispiel: Wir wollen einen Datensatz erstellen, der nur Pinguine der Insel Biscoe enthält und pro Spezies die durchschnittliche Schnabellänge berechnet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">penguins</span>, <span class="va">island</span> <span class="op">==</span> <span class="st">"Biscoe"</span><span class="op">)</span></span>
<span><span class="va">penguins_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">penguins_final</span>, <span class="va">species</span><span class="op">)</span></span>
<span><span class="va">penguins_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">penguins_final</span>, bill_len <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_len</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">penguins_final</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   species bill_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie      39.0</span></span>
<span><span class="co">#&gt; 2 Gentoo      47.5</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Für eine besser lesbare Verkettung von Funktionen werden wir in Zukunft Pipes (<code>|&gt;</code>) verwenden. Pipes ermöglichen, dass das Ergebnis eines Ausdrucks direkt an die nächste Funktion übergeben wird, ohne dass man verschachtelte Klammern schreiben muss oder Objekte mehrfach definieren muss.</p>
<p>Eine Pipe übergibt das Ergebnis des linken Ausdrucks automatisch als erstes Argument an die Funktion rechts: <code>x |&gt; f(y)</code> ↔︎ <code>f(x, y)</code> und <code>x |&gt; f(y) |&gt; g(z)</code> ↔︎ <code>g(f(x, y), z)</code>. Somit können wir den Code besser lesbar schreiben als:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">island</span> <span class="op">==</span> <span class="st">"Biscoe"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    bill_len <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_len</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   species bill_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie      39.0</span></span>
<span><span class="co">#&gt; 2 Gentoo      47.5</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section><section id="tidy-data-sets" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="tidy-data-sets">
<span class="header-section-number">3.2</span> Tidy Data Sets</h2>
<p>Daten können in unterschiedlicher Struktur dargestellt werden. Für die Arbeit in R eignet sich besonders das tidy data-Format. Es folgt drei Grundregeln: - Jede Variable ist eine Spalte - Jede Beobachtung ist eine Zeile - Jede Zelle enthält genau einen Wert</p>
<p>Durch diese Struktur wird der Datensatz übersichtlich, leicht zu analysieren und kompatibel mit modernen R-Werkzeugen wie <code>dplyr</code> und <code>ggplot2</code>.</p>
<p>In unserem Übungsdatensatz <code>penguins</code> ist jede Zeile ein einzelner Pinguin und in den Spalten erhalten wir Informationen zu bestimmten Variablen (z.B. Spezies oder Geschlecht) für jede dieser Pinguin-Beobachtungen.</p>
</section><section id="daten-auswählen-und-sortieren" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="daten-auswählen-und-sortieren">
<span class="header-section-number">3.3</span> Daten auswählen und sortieren</h2>
<p>Bevor wir mit Analysen beginnen, müssen wir häufig relevanten Daten auswählen und sortieren, um den Datensatz übersichtlich zu halten. Mit <code>dplyr</code> erledigen wir dies z.B. mit <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> zum Auswählen von Variablen, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> oder <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> zum Filtern von Zeilen, <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> und <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> zum Bereinigen von Duplikaten und fehlenden Werten sowie <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> zum Sortieren. So können wir gezielt nur die Informationen betrachten, die für die Analyse wichtig sind.</p>
<section id="select" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="select">
<span class="header-section-number">3.3.1</span> select()</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> ermöglicht es uns, nur die gewünschten Spalten eines Datensatzes zu behalten. Benötigen wir etwa nur Informationen zur Spezies, Insel und der Flügellänge können wir diese Variablen auswählen mit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">flipper_len</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 3</span></span>
<span><span class="co">#&gt;   species island    flipper_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen         181</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen         186</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen         195</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen          NA</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen         193</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen         190</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Um eine Variable zu entfernen, setzen wir ein Ausrufezeichen (<code>!</code>) davor (alternativ kann auch ein Minus verwendet werden):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">island</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 7</span></span>
<span><span class="co">#&gt;   species bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie      39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie      39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie      40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie      NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie      36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie      39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Um mehrere aufeinanderfolgende Variablen auszuwählen, können wir diese mit <code>firstvar:lastvar</code> zusammenfassen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">:</span><span class="va">body_mass</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 4</span></span>
<span><span class="co">#&gt;   bill_len bill_dep flipper_len body_mass</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1     39.1     18.7         181      3750</span></span>
<span><span class="co">#&gt; 2     39.5     17.4         186      3800</span></span>
<span><span class="co">#&gt; 3     40.3     18           195      3250</span></span>
<span><span class="co">#&gt; 4     NA       NA            NA        NA</span></span>
<span><span class="co">#&gt; 5     36.7     19.3         193      3450</span></span>
<span><span class="co">#&gt; 6     39.3     20.6         190      3650</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Eine Reihe von zusätzlichen <code>dplyr</code>-Funktionen sind im Zusammenhang ebenfalls hilfreich: <code>starts_with("text")</code>, <code>ends_with("text")</code> und <code>contains("text")</code> innerhalb von <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> wählen all jene Variablen aus, deren Namen mit <code>"text"</code> beginnen, enden bzw. <code>"text"</code> beinhalten. Mit <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code> werden alle Variablen ausgewählt, auf die eine bestimmte Kondition zutrifft. <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> wählt alle Variablen aus, <code><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col()</a></code> die letzte Spalte:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_dep</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     39.1     18.7</span></span>
<span><span class="co">#&gt; 2     39.5     17.4</span></span>
<span><span class="co">#&gt; 3     40.3     18  </span></span>
<span><span class="co">#&gt; 4     NA       NA  </span></span>
<span><span class="co">#&gt; 5     36.7     19.3</span></span>
<span><span class="co">#&gt; 6     39.3     20.6</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 3</span></span>
<span><span class="co">#&gt;   species island    sex   </span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt; </span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen male  </span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen female</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen female</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen female</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen male  </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 1</span></span>
<span><span class="co">#&gt;    year</span></span>
<span><span class="co">#&gt;   &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2007</span></span>
<span><span class="co">#&gt; 2  2007</span></span>
<span><span class="co">#&gt; 3  2007</span></span>
<span><span class="co">#&gt; 4  2007</span></span>
<span><span class="co">#&gt; 5  2007</span></span>
<span><span class="co">#&gt; 6  2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Damit der <code>penguins</code> Datensatz nicht immer wieder neu geladen werden muss, speichern wir Transformationen in diesem Kapitel nicht ab. In der eigenen Datenaufbereitung solltest du Änderungen einem Objekt zuweisen, damit diese erhalten bleiben:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">island</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section><section id="filter" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="filter">
<span class="header-section-number">3.3.2</span> filter()</h3>
<p>Mit filter() können wir bestimmte Zeilen eines Datensatzes auswählen, die bestimmte Bedingungen erfüllen. So lassen sich gezielt Beobachtungen extrahieren, etwa alle Pinguine der Art Adelie oder alle Pinguine mit einer Schnabellänge von mindestens 40 Milimetern:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 152 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 146 more rows</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 242 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     42       20.2         190      4250 &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     41.1     17.6         182      3200 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     42.5     20.7         197      4500 male    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     46       21.5         194      4200 male    2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Biscoe        40.6     18.6         183      3550 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 236 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Logische Operatoren in R
</div>
</div>
<div class="callout-body-container callout-body">
<p>Viele Schritte in der Datenaufbereitung setzen Kenntniss über logische Operatoren in R voraus. <a href="#tbl-logic-op" class="quarto-xref">Tabelle&nbsp;<span>3.2</span></a> fasst die wichtigsten zusammen:</p>
<div class="cell">
<div id="tbl-logic-op" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-logic-op-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;3.2: Übersicht: Logische Operatoren in R
</figcaption><div aria-describedby="tbl-logic-op-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Operator</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Bedeutung</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Beispiel</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">==</td>
<td style="text-align: left;">gleich</td>
<td style="text-align: left;">species == "Adelie"</td>
</tr>
<tr class="even">
<td style="text-align: left;">!=</td>
<td style="text-align: left;">ungleich</td>
<td style="text-align: left;">species != "Adelie"</td>
</tr>
<tr class="odd">
<td style="text-align: left;">&lt;</td>
<td style="text-align: left;">kleiner als</td>
<td style="text-align: left;">bill_len &lt; 40</td>
</tr>
<tr class="even">
<td style="text-align: left;">&gt;</td>
<td style="text-align: left;">größer als</td>
<td style="text-align: left;">bill_len &gt; 40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">&lt;=</td>
<td style="text-align: left;">kleiner oder gleich</td>
<td style="text-align: left;">bill_len &lt;= 40</td>
</tr>
<tr class="even">
<td style="text-align: left;">&gt;=</td>
<td style="text-align: left;">größer oder gleich</td>
<td style="text-align: left;">bill_len &gt;= 40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">%in%</td>
<td style="text-align: left;">enthalten in</td>
<td style="text-align: left;">species %in% c("Adelie", "Gentoo")</td>
</tr>
<tr class="even">
<td style="text-align: left;">!%in%</td>
<td style="text-align: left;">nicht enthalten in</td>
<td style="text-align: left;">species !%in% c("Adelie", "Gentoo")</td>
</tr>
<tr class="odd">
<td style="text-align: left;">&amp;</td>
<td style="text-align: left;">logisches UND</td>
<td style="text-align: left;">sex == "female" &amp; island == "Biscoe"</td>
</tr>
<tr class="even">
<td style="text-align: left;">|</td>
<td style="text-align: left;">logisches ODER</td>
<td style="text-align: left;">bill_len &gt;= 45 | bill_len &lt;= 35</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
</div>
<p>Wollen wir auf mehrere Konditionen gleichzeitig filtern, können wir diese in der Filter-Option angeben. Wir extrahieren weibliche Pinguine auf der Insel Biscoe mit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span> <span class="op">&amp;</span> <span class="va">island</span> <span class="op">==</span> <span class="st">"Biscoe"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 80 × 8</span></span>
<span><span class="co">#&gt;   species island bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Biscoe     37.8     18.3         174      3400 female  2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Biscoe     35.9     19.2         189      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Biscoe     35.3     18.9         187      3800 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Biscoe     40.5     17.9         187      3200 female  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Biscoe     37.9     18.6         172      3150 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Biscoe     39.6     17.7         186      3500 female  2008</span></span>
<span><span class="co">#&gt; # ℹ 74 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Das Subset an Pinguinen, die eine Schnabellänge von mindestens 45mm oder eine Schnabellänge von höchstens 35mm haben filtern wir mit dem Oder-Operator <code>|</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">45</span> <span class="op">|</span> <span class="va">bill_len</span> <span class="op">&lt;=</span> <span class="fl">35</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 177 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     34.1     18.1         193      3475 &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     34.6     21.1         198      4400 male    2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     34.4     18.4         184      3325 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     46       21.5         194      4200 male    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Biscoe        35       17.9         190      3450 female  2008</span></span>
<span><span class="co">#&gt; 6 Adelie  Biscoe        34.5     18.1         187      2900 female  2008</span></span>
<span><span class="co">#&gt; # ℹ 171 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Äquivalent zu den Base R Operatoren <code>&amp;</code> und <code>|</code> sind die <code>dplyr</code>-Funktionen <code><a href="https://dplyr.tidyverse.org/reference/when-any-all.html">when_all()</a></code> und <code><a href="https://dplyr.tidyverse.org/reference/when-any-all.html">when_any()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/when-any-all.html">when_all</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span>, <span class="va">island</span> <span class="op">==</span> <span class="st">"Biscoe"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 80 × 8</span></span>
<span><span class="co">#&gt;   species island bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Biscoe     37.8     18.3         174      3400 female  2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Biscoe     35.9     19.2         189      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Biscoe     35.3     18.9         187      3800 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Biscoe     40.5     17.9         187      3200 female  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Biscoe     37.9     18.6         172      3150 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Biscoe     39.6     17.7         186      3500 female  2008</span></span>
<span><span class="co">#&gt; # ℹ 74 more rows</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/when-any-all.html">when_any</a></span><span class="op">(</span><span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span>, <span class="va">body_mass</span> <span class="op">&gt;=</span> <span class="fl">4000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 253 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.2     19.6         195      4675 male    2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     42       20.2         190      4250 &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     41.1     17.6         182      3200 female  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     34.6     21.1         198      4400 male    2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     42.5     20.7         197      4500 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 247 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warnung</span>Umgang mit NAs: filter_out()
</div>
</div>
<div class="callout-body-container callout-body">
<p>Logische Bedingungen können bei fehlenden Werten ( (<code>NA</code>) Probleme verursachen. Wollen wir etwa alle weiblichen Pinguine aus dem Datensatz entfernen führt <code>penguins |&gt; filter(sex != "female")</code> dazu, dass sowohl weibliche Pinguine als auch jene mit fehlender Geschlechtsinformation ausgeschlossen werden.</p>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter_out()</a></code> schließen wir nur Beobachtungen aus, auf welche die Kondition zutrifft:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter_out</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 179 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex    year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male   2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;   2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     39.3     20.6         190      3650 male   2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     39.2     19.6         195      4675 male   2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     34.1     18.1         193      3475 &lt;NA&gt;   2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     42       20.2         190      4250 &lt;NA&gt;   2007</span></span>
<span><span class="co">#&gt; # ℹ 173 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Der Datensatz enthält jetzt keine weiblichen Pinguine mehr, aber jene mit fehlenden Werten sind weiterhin enthalten.</p>
</div>
</div>
</section><section id="slice" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="slice">
<span class="header-section-number">3.3.3</span> slice()</h3>
<p>Manchmal möchten wir nur einen Teil des Datensatzes auswählen, ohne explizit nach bestimmten Werten zu filtern. Das ist besonders praktisch bei großen Datensätzen, wenn wir zunächst nur mit einem Sample arbeiten wollen, um Rechenressourcen zu schonen. Dafür nutzen wir <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>, zum Beispiel um die Zeilen 1, 3 und 6–8 aus dem <code>penguins</code>-Datensatz auszuwählen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     38.9     17.8         181      3625 female  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     39.2     19.6         195      4675 male    2007</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Für <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> steht eine Reihe hilfreicher Varianten zur Verfügung:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code>/<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail()</a></code>: Nimmt die ersten/letzen N Beobachtungen eines Datensatzes (<code>penguins |&gt; slice_head(n = 10)</code>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code>/<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code>: Nimmt die N Beobachtungen mit den niedrigsten/höchsten Werten einer Variable (<code>penguins |&gt; slice_min(bill_len, n = 5)</code>)</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code>: Zieht zufällig N Beobachtungen aus dem gesamten Datensatz (<code>penguins |&gt; slice_sample(n = 5)</code>). Für Reproduzierbarkeit sollte zuerst mit <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> ein Seed gesetzt werden.</li>
</ul>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>slice() mit gruppierten Daten
</div>
</div>
<div class="callout-body-container callout-body">
<p>Haben wir den Datensatz mit <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> in Gruppen klassifiziert, so wird die jeweilige slice-Operation auf jede Gruppe separat angewandt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max</a></span><span class="op">(</span><span class="va">bill_len</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 8</span></span>
<span><span class="co">#&gt; # Groups:   island [3]</span></span>
<span><span class="co">#&gt;   species   island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Gentoo    Biscoe        59.6     17           230      6050 male    2007</span></span>
<span><span class="co">#&gt; 2 Gentoo    Biscoe        55.9     17           228      5600 male    2009</span></span>
<span><span class="co">#&gt; 3 Chinstrap Dream         58       17.8         181      3700 female  2007</span></span>
<span><span class="co">#&gt; 4 Chinstrap Dream         55.8     19.8         207      4000 male    2009</span></span>
<span><span class="co">#&gt; 5 Adelie    Torgersen     46       21.5         194      4200 male    2007</span></span>
<span><span class="co">#&gt; 6 Adelie    Torgersen     45.8     18.9         197      4150 male    2008</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section><section id="distinct" class="level3" data-number="3.3.4"><h3 data-number="3.3.4" class="anchored" data-anchor-id="distinct">
<span class="header-section-number">3.3.4</span> distinct()</h3>
<p>Oft enthält ein Datensatz doppelte Zeilen, die für die Analyse nicht relevant sind. Mit <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code> können wir gezielt nur die einzigartigen Beobachtungen behalten und so Redundanzen entfernen. Zum Beispiel lassen sich im penguins-Datensatz alle verschiedenen Kombinationen aus Spezies und Insel extrahieren:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 2</span></span>
<span><span class="co">#&gt;   species   island   </span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;    </span></span>
<span><span class="co">#&gt; 1 Adelie    Torgersen</span></span>
<span><span class="co">#&gt; 2 Adelie    Biscoe   </span></span>
<span><span class="co">#&gt; 3 Adelie    Dream    </span></span>
<span><span class="co">#&gt; 4 Gentoo    Biscoe   </span></span>
<span><span class="co">#&gt; 5 Chinstrap Dream</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Spezifizieren wir keine Variablen innerhalb von <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>, so droppen wir alle Duplikate aus dem Datensatz (im <code>penguins</code> Datensatz gibt aber es keine zwei identen Beobachtungen). Mit der Option <code>.keep_all = TRUE</code> behalten wir die Informationen in allen weiteren Variablen für die erste distinkte Beobachtung:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 8</span></span>
<span><span class="co">#&gt;   species   island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie    Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie    Biscoe        37.8     18.3         174      3400 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie    Dream         39.5     16.7         178      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Gentoo    Biscoe        46.1     13.2         211      4500 female  2007</span></span>
<span><span class="co">#&gt; 5 Chinstrap Dream         46.5     17.9         192      3500 female  2007</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="drop_na" class="level3" data-number="3.3.5"><h3 data-number="3.3.5" class="anchored" data-anchor-id="drop_na">
<span class="header-section-number">3.3.5</span> drop_na()</h3>
<p>Oft enthalten Datensätze fehlende Werte (<code>NA</code>), die bestimmte Analysen oder Berechnungen stören können. Mit <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> können wir gezielt alle Zeilen entfernen, die in ausgewählten Variablen fehlende Werte enthalten, und so einen sauberen Datensatz erhalten. Zum Beispiel lässt sich im <code>penguins</code>-Datensatz nur jene Beobachtungen behalten, bei denen die Schnabeltiefe nicht fehlt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">bill_dep</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 342 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     38.9     17.8         181      3625 female  2007</span></span>
<span><span class="co">#&gt; # ℹ 336 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Spezifizieren wir keine Variable innerhalb von <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code>, so werden sämtliche Beobachtungen mit zumindest einem fehlenden Wert in einer der Variablen ausgeschlossen (<code>penguins |&gt; drop_na()</code>).</p>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warnung</span>Gefahren beim Entfernen fehlender Werte
</div>
</div>
<div class="callout-body-container callout-body">
<p>Man sollte mit <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> vorsichtig sein, weil beim Entfernen von Zeilen mit fehlenden Werten unter Umständen wichtige Daten verloren gehen. Gerade wenn viele Variablen NA-Werte enthalten, kann das zu einer stark verkleinerten Stichprobe führen und die Analyse verzerren. Deshalb sollte man vorher prüfen, wie viele Werte betroffen sind und überlegen, ob alternative Strategien wie Imputation oder gezieltes Entfernen nur einzelner Spalten sinnvoller sind.</p>
</div>
</div>
</section><section id="arrange" class="level3" data-number="3.3.6"><h3 data-number="3.3.6" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">3.3.6</span> arrange()</h3>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> können wir die Zeilen eines Datensatzes nach einer oder mehreren Variablen sortieren. So lassen sich Daten übersichtlicher darstellen, Extremwerte leicht erkennen oder vorbereitend für weitere Analysen ordnen, ohne den Datensatz inhaltlich zu verändern.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">bill_len</span>, <span class="va">bill_dep</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Dream         32.1     15.5         188      3050 female  2009</span></span>
<span><span class="co">#&gt; 2 Adelie  Dream         33.1     16.1         178      2900 female  2008</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     33.5     19           190      3600 female  2008</span></span>
<span><span class="co">#&gt; 4 Adelie  Dream         34       17.1         185      3400 female  2008</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     34.1     18.1         193      3475 &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     34.4     18.4         184      3325 female  2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Wenn mehr als eine Variable angeführt ist, ordnet <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> zuerst nach der erstgenannten und nur bei Gleichstand nach den weiteren Variablen. Fehlende Werte werden immer als letztes angeordnet. Per Default ordnet <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> von unten nach oben. Wollen wir vom Maximum aus sortieren, verwenden wir <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code> innerhalb von <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species   island bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Gentoo    Biscoe     59.6     17           230      6050 male    2007</span></span>
<span><span class="co">#&gt; 2 Chinstrap Dream      58       17.8         181      3700 female  2007</span></span>
<span><span class="co">#&gt; 3 Gentoo    Biscoe     55.9     17           228      5600 male    2009</span></span>
<span><span class="co">#&gt; 4 Chinstrap Dream      55.8     19.8         207      4000 male    2009</span></span>
<span><span class="co">#&gt; 5 Gentoo    Biscoe     55.1     16           230      5850 male    2009</span></span>
<span><span class="co">#&gt; 6 Gentoo    Biscoe     54.3     15.7         231      5650 male    2008</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="variablen-verändern-und-erstellen" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="variablen-verändern-und-erstellen">
<span class="header-section-number">3.4</span> Variablen verändern und erstellen</h2>
<p>Neben dem Auswählen und Sortieren ist es für viele Analysen notwendig, Variablen zu verändern oder neue zu erstellen. Mit <code>dplyr</code> nutzen wir dafür insbesondere <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> zur Berechnung oder Transformation von Variablen. Außerdem lernen wir in diesem Abschnitt, wie wir diese Umwandlungen auf Basis bedingter Fallunterscheidungen treffen (<code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">replace_when()</a></code>) und wie wir einzelne Ausprägungen von Variabeln gezielt umcodieren (<code><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">recode_values()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">replace_values()</a></code>). Auf diese Weise lassen sich Variablen anpassen, neu strukturieren und in eine Form bringen, die für statistische Auswertungen geeignet ist.</p>
<section id="mutate" class="level3" data-number="3.4.1"><h3 data-number="3.4.1" class="anchored" data-anchor-id="mutate">
<span class="header-section-number">3.4.1</span> mutate()</h3>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> erstellen wir neue Spalten (Variablen), häufig auf Basis bereits existierender Spalten. Wir können damit etwa jeder Beobachtung in <code>penguins</code> eine Beobachtungs-ID hinzufügen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 9</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: id &lt;int&gt;</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Per Default wir diese Variable an das Ende des Datensatzes hinzugefügt. Wir können die Position der Variable jedoch mit dem Argument <code>.before = ...</code> bzw. <code>.after = ...</code> spezifizieren, wobei hier sowohl numerische Werte für die Spaltenzahl sowie Variablennamen akzeptiert werden.</p>
<p>Besonders hilfreich ist <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> um neue Variablen auf Basis der Werte in bereits bestehenden zu definieren. Wollen wir etwa uns das Verhältnis von Schnabellänge und Schnabeltiefe (auf zwei Dezimalstellen gerundet) angeben, und diese neue Variable im Datensatz nach <code>bill_dep</code> angeordnet haben:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">/</span><span class="va">bill_dep</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">bill_dep</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 9</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep bill_ratio flipper_len body_mass sex   </span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt; </span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7       2.09         181      3750 male  </span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4       2.27         186      3800 female</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18         2.24         195      3250 female</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA        NA             NA        NA &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3       1.9          193      3450 female</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6       1.91         190      3650 male  </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: year &lt;int&gt;</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Innerhalb von <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> können wir auch mehrere Variablen gleichzeitig definieren, indem wir die jeweiligen Operationen mit einem Komma trennen. Wenn wir keine neue Variable kreieren, sondern eine bestehende adaptieren wollen, verwenden wir einfach den jeweiligen Variablennamen auf der linken Seite. Wollen wir etwa eine Beobachtungs-ID hinzufügen, das Schnabel-Ratio erstellen und das Gewicht in Kilogramm anstelle von Gramm angegeben haben:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    bill_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">/</span><span class="va">bill_dep</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    body_mass <span class="op">=</span> <span class="va">body_mass</span><span class="op">/</span><span class="fl">1000</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">bill_len</span>, <span class="va">bill_dep</span>, <span class="va">bill_ratio</span>, <span class="va">body_mass</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 5</span></span>
<span><span class="co">#&gt;      id bill_len bill_dep bill_ratio body_mass</span></span>
<span><span class="co">#&gt;   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1     39.1     18.7       2.09      3.75</span></span>
<span><span class="co">#&gt; 2     2     39.5     17.4       2.27      3.8 </span></span>
<span><span class="co">#&gt; 3     3     40.3     18         2.24      3.25</span></span>
<span><span class="co">#&gt; 4     4     NA       NA        NA        NA   </span></span>
<span><span class="co">#&gt; 5     5     36.7     19.3       1.9       3.45</span></span>
<span><span class="co">#&gt; 6     6     39.3     20.6       1.91      3.65</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>Relevante Funktionen für mutate()
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#tbl-mutate-functions" class="quarto-xref">Tabelle&nbsp;<span>3.3</span></a> zeigt wichtige Funktionen, die wir oft mit mutate() verwenden, um neue Variablen zu erstellen oder bestehende zu verändern:</p>
<div class="cell">
<div id="tbl-mutate-functions" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mutate-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;3.3: Übersicht: Relevante Funktionen für mutate()
</figcaption><div aria-describedby="tbl-mutate-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Funktion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Bedeutung</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Beispiel</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">row_number()</td>
<td style="text-align: left;">Laufende Zeilennummer (ggf. innerhalb von Gruppen)</td>
<td style="text-align: left;">id = row_number()</td>
</tr>
<tr class="even">
<td style="text-align: left;">lag(), lead()</td>
<td style="text-align: left;">Vorheriger/nächster Wert (zeilenweise Verschiebung)</td>
<td style="text-align: left;">prev_mass = lag(body_mass)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cumsum()</td>
<td style="text-align: left;">Kumulierte Summe</td>
<td style="text-align: left;">cum_mass = cumsum(body_mass, na.rm = T)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pmin(), pmax()</td>
<td style="text-align: left;">Elementweises (Zeilenweises) Minimum/Maximum mehrerer Vektoren</td>
<td style="text-align: left;">max_bill = pmax(bill_len, bill_depth)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">abs()</td>
<td style="text-align: left;">Absolutwert</td>
<td style="text-align: left;">abs_diff = abs(bill_len - bill_depth)</td>
</tr>
<tr class="even">
<td style="text-align: left;">round()</td>
<td style="text-align: left;">Rundet auf bestimmte Dezimalstellen</td>
<td style="text-align: left;">body_mass = round(body_mass/1000, digits = 2)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">floor(), ceiling()</td>
<td style="text-align: left;">Rundet ab/auf</td>
<td style="text-align: left;">body_mass = floor(body_mass/1000)</td>
</tr>
<tr class="even">
<td style="text-align: left;">cut()</td>
<td style="text-align: left;">Fasst numerische Variablen in Kategorien zusammen</td>
<td style="text-align: left;">bill_len_group = cut(bill_len, breaks = 3))</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><em>Hinweis</em>: Bei manchen Funktionen müssen wir auf den Umgang mit <code>NA</code> Werten achten! Wenn du bei diesen <code>na.rm = TRUE</code> angibst, ignoriert die Funktion alle fehlenden Werte und berechnet das Ergebnis nur mit den vorhandenen, gültigen Werten.</p>
</div>
</div>
</section><section id="if_else-case_when-replace_when" class="level3" data-number="3.4.2"><h3 data-number="3.4.2" class="anchored" data-anchor-id="if_else-case_when-replace_when">
<span class="header-section-number">3.4.2</span> if_else(), case_when() &amp; replace_when()</h3>
<p>Oft wollen wir eine Variable basierend auf Konditionen transformieren. Für konditionelle Transformationen greifen wir auf <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> zurück. Diese Funktion folgt immer dem Schema <code>if_else(condition, output_true, output_false)</code>. Um Schnabellängen in große Schnäbel (&gt;=40mm) und kleine Schnäbel (&lt;40mm) zu unterteilen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">&gt;=</span><span class="fl">40</span>, <span class="st">"large"</span>, <span class="st">"small"</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1     39.1 small    </span></span>
<span><span class="co">#&gt; 2     39.5 small    </span></span>
<span><span class="co">#&gt; 3     40.3 large    </span></span>
<span><span class="co">#&gt; 4     NA   &lt;NA&gt;     </span></span>
<span><span class="co">#&gt; 5     36.7 small    </span></span>
<span><span class="co">#&gt; 6     39.3 small    </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die <code>dplyr</code>-Funktion <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> ist in den meisten Fällen ident zur Base R Version <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>. Die Vorteile von <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> liegen im Umgang mit fehlenden Werten und inkompatiblen Datentypen.</p>
</div>
</div>
<p>Wir können durch Nesting von <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code> für mehrere Konditionen Transformationen definieren:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">&gt;=</span><span class="fl">40</span>, <span class="st">"large"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">bill_len</span><span class="op">&gt;=</span><span class="fl">37</span>, <span class="st">"medium"</span>, <span class="st">"small"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1     39.1 medium   </span></span>
<span><span class="co">#&gt; 2     39.5 medium   </span></span>
<span><span class="co">#&gt; 3     40.3 large    </span></span>
<span><span class="co">#&gt; 4     NA   &lt;NA&gt;     </span></span>
<span><span class="co">#&gt; 5     36.7 small    </span></span>
<span><span class="co">#&gt; 6     39.3 medium   </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nesting führt jedoch dazu, dass der Code immer schlechter lesbar wird. Stattdessen verwenden wir in solchen Fällen besser <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code>. Hier definieren wird für jede Kondition einen Output, nach dem Syntax <code>condition ~ output</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"large"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&lt;</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"small"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1     39.1 medium   </span></span>
<span><span class="co">#&gt; 2     39.5 medium   </span></span>
<span><span class="co">#&gt; 3     40.3 large    </span></span>
<span><span class="co">#&gt; 4     NA   &lt;NA&gt;     </span></span>
<span><span class="co">#&gt; 5     36.7 small    </span></span>
<span><span class="co">#&gt; 6     39.3 medium   </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Mit dem Argument <code>.default = output</code> können wir außerdem den Output kontrollieren, wenn keine der Konditionen zutrifft:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"large"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&lt;</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"small"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"no bill length"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size     </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt; 1     39.1 medium        </span></span>
<span><span class="co">#&gt; 2     39.5 medium        </span></span>
<span><span class="co">#&gt; 3     40.3 large         </span></span>
<span><span class="co">#&gt; 4     NA   no bill length</span></span>
<span><span class="co">#&gt; 5     36.7 small         </span></span>
<span><span class="co">#&gt; 6     39.3 medium        </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warnung</span>Fehlerquellen bei case_when()
</div>
</div>
<div class="callout-body-container callout-body">
<p>Beim konditionellen Transformieren mit <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code> sind zwei Punkte zu beachten. Erstens werden die Konditionen der Reihe nach durchgegangen und spätere Konditionen nur dann evaluiert, wenn für den jeweiligen Wert die vorherigen Konditionen alle nicht zutreffen. Fehler bei der Reihenfolge führen also zu Fehlern in der Transformation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"large"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&lt;</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"small"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"no bill length"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size     </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt; 1     39.1 medium        </span></span>
<span><span class="co">#&gt; 2     39.5 medium        </span></span>
<span><span class="co">#&gt; 3     40.3 medium        </span></span>
<span><span class="co">#&gt; 4     NA   no bill length</span></span>
<span><span class="co">#&gt; 5     36.7 small         </span></span>
<span><span class="co">#&gt; 6     39.3 medium        </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Zweitens sollten immer alle möglichen Konditionen definiert sein. Spezifizieren wir beispielsweise nicht die Kondition für <code>bill_size == "small"</code> sondern setzen wir diese nur als Default, wird dieser Output auch auf fehlende Werte angewendet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    bill_size <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">40</span> <span class="op">~</span> <span class="st">"large"</span>,</span>
<span>      <span class="va">bill_len</span> <span class="op">&gt;=</span> <span class="fl">37</span> <span class="op">~</span> <span class="st">"medium"</span>,</span>
<span>      .default <span class="op">=</span> <span class="st">"small"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 2</span></span>
<span><span class="co">#&gt;   bill_len bill_size</span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1     39.1 medium   </span></span>
<span><span class="co">#&gt; 2     39.5 medium   </span></span>
<span><span class="co">#&gt; 3     40.3 large    </span></span>
<span><span class="co">#&gt; 4     NA   small    </span></span>
<span><span class="co">#&gt; 5     36.7 small    </span></span>
<span><span class="co">#&gt; 6     39.3 medium   </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>Möchten wir nur einzelne Werte einer existierenden Variable in Abhängigkeit von anderen Variablen verändern, ist die Funktion <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">replace_when()</a></code> hilfreich. Diese folgt dem Syntax <code>replace_when(variable, condition ~ output)</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">replace_when</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span> <span class="op">&amp;</span> <span class="va">bill_dep</span> <span class="op">&gt;</span> <span class="fl">18</span> <span class="op">~</span> <span class="st">"male"</span><span class="op">)</span>,</span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 3</span></span>
<span><span class="co">#&gt;   species bill_dep sex  </span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt; &lt;fct&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie      18.9 male </span></span>
<span><span class="co">#&gt; 2 Adelie      17.1 &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 3 Adelie      18.1 male </span></span>
<span><span class="co">#&gt; 4 Adelie      17.3 &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 5 Gentoo      14.3 &lt;NA&gt; </span></span>
<span><span class="co">#&gt; 6 Adelie      20.2 male </span></span>
<span><span class="co">#&gt; # ℹ 5 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Im Vergleich zu <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code> hat diese Funktion den Vorteil, dass die ursprünglichen Werte von <code>variable</code> bei Nicht-Zutreffen der Kondition übernommen werden, und nicht als <code>.default = variable</code> spezifiziert werden müssen. Außerdem erhält <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">replace_when()</a></code> den ursprünglichen Datentyp der Ausgangsvariable.</p>
</section><section id="recode_values-replace_values" class="level3" data-number="3.4.3"><h3 data-number="3.4.3" class="anchored" data-anchor-id="recode_values-replace_values">
<span class="header-section-number">3.4.3</span> recode_values() &amp; replace_values()</h3>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code> und <code>recode_when()</code> haben wir Variablen auf Basis konditioneller Logik transformiert. Wollen wir die alten Werte von <code>sex</code> in neue Werte übersetzen, können wir <code><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">recode_values()</a></code> verwenden:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span>,</span>
<span>      <span class="st">"male"</span> <span class="op">~</span> <span class="st">"M"</span>,</span>
<span>      <span class="st">"female"</span> <span class="op">~</span> <span class="st">"F"</span>,</span>
<span>      default <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex    year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 M      2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 F      2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 F      2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;   2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 F      2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 M      2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Wie bei <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">case_when()</a></code> können wir also Transformationen mit der Logik <code>old_value ~ new_value</code> vornehmen und eine Default-Option spezifizieren. Der Vorteil von <code><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">recode_values()</a></code> besteht aber, wenn eine Vielzahl von Werten umcodiert wird. Diese müssen wir hier nicht als einzelne Konditionen definieren, sondern können die alten und neuen Werte gesammelt als Vektoren (in der selben Reihenfolge) über die Argumente <code>from = old_values</code> und <code>to = new_values</code> definieren:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">recode_values</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span>,</span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span>,</span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span>,</span>
<span>      default <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex    year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;chr&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 M      2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 F      2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 F      2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;   2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 F      2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 M      2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Für das Umcodieren einzelner Werte einer bestehenden Variable gibt es mit <code><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">replace_values()</a></code> eine äquivalente Funktion zu <code><a href="https://dplyr.tidyverse.org/reference/case-and-replace-when.html">replace_when()</a></code>. Auch hier werden als Default wieder automatisch die existierenden Werte verwendet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode-and-replace-values.html">replace_values</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, <span class="cn">NA</span> <span class="op">~</span> <span class="st">"sex unknown"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex          year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male         2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female       2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female       2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA sex unknown  2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female       2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male         2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Use Cases
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div id="tbl-logic-transf" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-logic-transf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;3.4: Übersicht: if_else(), case_when(), replace_when(), recode_values(), replace_values()
</figcaption><div aria-describedby="tbl-logic-transf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Funktion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Use Case</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">if_else()</td>
<td style="text-align: left;">Erstellen einer neuen Variable basierend auf konditioneller Logik (eine Kondition)</td>
</tr>
<tr class="even">
<td style="text-align: left;">case_when()</td>
<td style="text-align: left;">Erstellen einer neuen Variable basierend auf konditioneller Logik (mehrere Konditionen)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">replace_when()</td>
<td style="text-align: left;">Updaten einer existierenden Variable basierend auf konditioneller Logik</td>
</tr>
<tr class="even">
<td style="text-align: left;">recode_values()</td>
<td style="text-align: left;">Mapping von allen alten Werten zu neuen Werten</td>
</tr>
<tr class="odd">
<td style="text-align: left;">replace_values()</td>
<td style="text-align: left;">Mapping bestimmter alter Werte zu neuen Werten</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
</div>
</section></section><section id="gruppieren-und-zusammenfassen" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="gruppieren-und-zusammenfassen">
<span class="header-section-number">3.5</span> Gruppieren und Zusammenfassen</h2>
<p>Die Stärken von <code>dplyr</code> liegen vor allem in der Datenaufbereitung innerhalb bestimmter Subgruppen. Häufig wollen wir unsere Daten in Gruppen strukturieren und uns Kennzahlen innerhalb dieser Gruppen berechnen. In <code>dpylr</code> nutzen wir dafür insbesondere <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, um Beobachtungen nach bestimmten Kategorien zu gruppieren, und <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> oder <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, um Mittelwerte, Summen, Häufigkeiten oder andere aggregierte Werte pro Gruppe zu berechnen. Auf diese Weise lassen sich Daten auf einer höheren Ebene zusammenfassen, vergleichen und in eine Form bringen, die übersichtliche Analysen und Visualisierungen ermöglicht.</p>
<section id="group_by" class="level3" data-number="3.5.1"><h3 data-number="3.5.1" class="anchored" data-anchor-id="group_by">
<span class="header-section-number">3.5.1</span> group_by()</h3>
<p>Um einen Datensatz in einzelne Gruppen zu unterteilen, nutzen wir <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. Damit können wir den <code>penguins</code>-Datensatz zum Beispiel nach Geschlecht unterteilen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt; # Groups:   sex [3]</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Der Datensatz ist jetzt ein gruppierter Tibble. Der Output sagt uns, dass wir drei Gruppen in der <code>sex</code> Variable gebildet haben. Während die Daten an sich unverändert bleiben, werden jetzt alle weiteren Operationen innerhalb dieser Gruppen durchgeführt. So können wir nun etwa eine neue Variable hinzufügen, die uns das durchschnittliche Gewicht pro Gruppe gibt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">body_mass</span>, <span class="va">bill_len</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    avg_body_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">body_mass</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 4</span></span>
<span><span class="co">#&gt; # Groups:   sex [3]</span></span>
<span><span class="co">#&gt;   sex    body_mass avg_body_mass bill_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt;         &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 male        3750          4546     39.1</span></span>
<span><span class="co">#&gt; 2 female      3800          3862     39.5</span></span>
<span><span class="co">#&gt; 3 female      3250          3862     40.3</span></span>
<span><span class="co">#&gt; 4 &lt;NA&gt;          NA          4006     NA  </span></span>
<span><span class="co">#&gt; 5 female      3450          3862     36.7</span></span>
<span><span class="co">#&gt; 6 male        3650          4546     39.3</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Um anschließend wieder mit ungruppierten Daten weiterzuarbeiten, verwenden wir <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">body_mass</span>, <span class="va">bill_len</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    avg_body_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">body_mass</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    avg_bill_len <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_len</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 5</span></span>
<span><span class="co">#&gt;   sex    body_mass avg_body_mass bill_len avg_bill_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt;         &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 male        3750          4546     39.1         43.9</span></span>
<span><span class="co">#&gt; 2 female      3800          3862     39.5         43.9</span></span>
<span><span class="co">#&gt; 3 female      3250          3862     40.3         43.9</span></span>
<span><span class="co">#&gt; 4 &lt;NA&gt;          NA          4006     NA           43.9</span></span>
<span><span class="co">#&gt; 5 female      3450          3862     36.7         43.9</span></span>
<span><span class="co">#&gt; 6 male        3650          4546     39.3         43.9</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>.by
</div>
</div>
<div class="callout-body-container callout-body">
<p>Möchten wir die Gruppenstruktur nur für eine einzelne Operation verwenden, entsteht durch <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> und <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> zusätzliche Codezeilen, welche den Code unübersichtlicher machen. Anstelle dessen können wir innerhalb von <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> (und später auch <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>) das Argument <code>.by = ...</code> verwenden. Dadurch wird die Gruppierung nur innerhalb der Funktion angewandt, der resultierende Datensatz bleibt jedoch ungruppiert:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">body_mass</span>, <span class="va">bill_len</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    avg_body_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">body_mass</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 4</span></span>
<span><span class="co">#&gt;   sex    body_mass avg_body_mass bill_len</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;int&gt;         &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 male        3750          4546     39.1</span></span>
<span><span class="co">#&gt; 2 female      3800          3862     39.5</span></span>
<span><span class="co">#&gt; 3 female      3250          3862     40.3</span></span>
<span><span class="co">#&gt; 4 &lt;NA&gt;          NA          4006     NA  </span></span>
<span><span class="co">#&gt; 5 female      3450          3862     36.7</span></span>
<span><span class="co">#&gt; 6 male        3650          4546     39.3</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>Wir können Gruppen auch auf Basis von mehreren Variablen bilden. Wir können den <code>penguin</code> Datensatz beispielsweise nach <code>species</code> und <code>island</code> gruppieren:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 8</span></span>
<span><span class="co">#&gt; # Groups:   species, island [5]</span></span>
<span><span class="co">#&gt;   species island    bill_len bill_dep flipper_len body_mass sex     year</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen     39.1     18.7         181      3750 male    2007</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen     39.5     17.4         186      3800 female  2007</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen     40.3     18           195      3250 female  2007</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen     NA       NA            NA        NA &lt;NA&gt;    2007</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen     36.7     19.3         193      3450 female  2007</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen     39.3     20.6         190      3650 male    2007</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Gruppen werden nur für jene Kombinationen gebildet, für die Beobachtungen vorhanden sind. Obwohl es drei Inseln und drei Arten im Datensatz gibt, werden nicht neun sondern nur fünf Gruppen gebildet. Dies liegt daran, dass es nur die Spezies <em>Adelie</em> auf allen drei Inseln gibt, während die beiden anderen Arten nur auf jeweils einer Insel beobachtet wurden.</p>
</section><section id="summarize" class="level3" data-number="3.5.2"><h3 data-number="3.5.2" class="anchored" data-anchor-id="summarize">
<span class="header-section-number">3.5.2</span> summarize()</h3>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> haben wir bisher Werte zeilenweise berechnet. Wollen wir Daten auf einer höheren Ebene zusammenfassen, verwenden wir die <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>. Diese führt eine bestimmte Funktion auf Gruppenebene durch. Um für jede Insel die Anzahl der beobachteten Pinguine und das durchschnittliche Gewicht zu berechnen, schreiben wir:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n_penguins <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    avg_body_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   island    n_penguins avg_body_mass</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;          &lt;int&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Biscoe           168          4716</span></span>
<span><span class="co">#&gt; 2 Dream            124          3713</span></span>
<span><span class="co">#&gt; 3 Torgersen         52          3706</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Der resultierende Datensatz enthält nun die beiden neu definierten Variablen (<code>n_penguins</code>, <code>avg_body_mass</code>) auf Ebene der einzelnen Gruppen (<code>island</code>).</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>summarize() und summarise()
</div>
</div>
<div class="callout-body-container callout-body">
<p>Aufgrund von Unterschieden in der britischen und amerikanischen Rechtschreibung bietet <code>dplyr()</code> auch die Funktion <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> an, welche ident zu <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> ist.</p>
</div>
</div>
<p>Ohne Gruppierung behandelt <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> den gesamten Datensatz als gemeinsame Gruppe:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n_penguins <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    avg_body_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   n_penguins avg_body_mass</span></span>
<span><span class="co">#&gt;        &lt;int&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1        344          4202</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Hinweis</span>Relevante Funktionen für summarize()
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#tbl-summarize-functions" class="quarto-xref">Tabelle&nbsp;<span>3.5</span></a> zeigt wichtige Funktionen, die wir oft mit summarize() verwenden, um aggregierte Kennzahlen zu erstellen:</p>
<div class="cell">
<div id="tbl-summarize-functions" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summarize-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabelle&nbsp;3.5: Übersicht: Relevante Funktionen für summarize()
</figcaption><div aria-describedby="tbl-summarize-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped do-not-create-environment cell caption-top table-sm small">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Funktion</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Bedeutung</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Beispiel</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n()</td>
<td style="text-align: left;">Anzahl Beobachtungen</td>
<td style="text-align: left;">n = n()</td>
</tr>
<tr class="even">
<td style="text-align: left;">n_distinct()</td>
<td style="text-align: left;">Anzahl unterschiedlicher Werte</td>
<td style="text-align: left;">unique_species = n_distinct(species)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mean()</td>
<td style="text-align: left;">Arithmetisches Mittel</td>
<td style="text-align: left;">avg_mass = mean(body_mass_g, na.rm = TRUE)</td>
</tr>
<tr class="even">
<td style="text-align: left;">median(), quantile()</td>
<td style="text-align: left;">Median oder beliebiges Quantil berechnen</td>
<td style="text-align: left;">med_mass = median(body_mass_g, na.rm = TRUE)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sd(), var()</td>
<td style="text-align: left;">Standardabweichung oder Varianz</td>
<td style="text-align: left;">sd_mass = sd(body_mass_g, na.rm = TRUE)</td>
</tr>
<tr class="even">
<td style="text-align: left;">min(), max()</td>
<td style="text-align: left;">Minimum oder Maximum</td>
<td style="text-align: left;">min_mass = min(body_mass_g, na.rm = TRUE)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sum()</td>
<td style="text-align: left;">Summe</td>
<td style="text-align: left;">total_mass = sum(body_mass_g, na.rm = TRUE)</td>
</tr>
<tr class="even">
<td style="text-align: left;">first(), last(), nth()</td>
<td style="text-align: left;">Erster, letzter oder n-ter Wert einer Gruppe</td>
<td style="text-align: left;">first_mass = first(body_mass_g)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">any()</td>
<td style="text-align: left;">Mindestens einmal erfüllt</td>
<td style="text-align: left;">any_na_sex = any(is.na(sex))</td>
</tr>
<tr class="even">
<td style="text-align: left;">all()</td>
<td style="text-align: left;">Immer erfüllt</td>
<td style="text-align: left;">all_na_sex = all(is.na(sex))</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><em>Hinweis</em>: Bei manchen Funktionen müssen wir auf den Umgang mit <code>NA</code> Werten achten! Wenn du bei diesen <code>na.rm = TRUE</code> angibst, ignoriert die Funktion alle fehlenden Werte und berechnet das Ergebnis nur mit den vorhandenen, gültigen Werten.</p>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Verwendung von across()
</div>
</div>
<div class="callout-body-container callout-body">
<p>Möchten wir die selbe Kennzahl für mehrere Variablen berechnen, stellt uns <code>tidyverse</code> die Funktion <code>across(.cols = c(var1, var2), ~ function(.x))</code> zur Verfügung, wobei <code>.x</code> der Placeholder für die jeweiligen Variablen ist. Wollen wir uns etwa den Mittelwert von Schnabellänge, Schnabeltiefe, Flügellänge und Körpergewicht pro Insel berechenen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">island</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">bill_len</span><span class="op">:</span><span class="va">body_mass</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 5</span></span>
<span><span class="co">#&gt;   island    bill_len bill_dep flipper_len body_mass</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Biscoe        45.3     15.9        210.     4716 </span></span>
<span><span class="co">#&gt; 2 Dream         44.2     18.3        193.     3713.</span></span>
<span><span class="co">#&gt; 3 Torgersen     39       18.4        191.     3706.</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section><section id="count" class="level3" data-number="3.5.3"><h3 data-number="3.5.3" class="anchored" data-anchor-id="count">
<span class="header-section-number">3.5.3</span> count()</h3>
<p>Um Häufigkeiten von Variablenausprägungen zu zählen, ohne vorher <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> und <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verwenden zu müssen, nutzen wir die Funktion <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>. Sie ist besonders praktisch, wenn wir schnell überblicken wollen, wie viele Beobachtungen jede Kategorie enthält, z.B. wie viele Pinguine jeder Art auf jeder Insel vertreten sind:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 3</span></span>
<span><span class="co">#&gt;   species   island        n</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie    Biscoe       44</span></span>
<span><span class="co">#&gt; 2 Adelie    Dream        56</span></span>
<span><span class="co">#&gt; 3 Adelie    Torgersen    52</span></span>
<span><span class="co">#&gt; 4 Chinstrap Dream        68</span></span>
<span><span class="co">#&gt; 5 Gentoo    Biscoe      124</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Dies ist ident zu einer Kombination aus <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> und <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="datensätze-zusammenführen" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="datensätze-zusammenführen">
<span class="header-section-number">3.6</span> Datensätze zusammenführen</h2>
<p>Oft liegen Daten nicht in einer einzigen Tabelle vor, sondern in mehreren Datensätzen, die unterschiedliche Informationen über dieselben Beobachtungen oder unterschiedliche Zeitpunkte enthalten. In R möchten wir diese Datensätze verbinden, um alle relevanten Informationen zusammenzuführen und so eine vollständige Grundlage für Analyse, Visualisierung oder Modellierung zu schaffen.</p>
<p>Um die dafür in <code>dpylr</code> vorhandenen Funktionen kennenzulernen, erstellen wir vier neue Datensätze::</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">students1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Anna Maria"</span>, <span class="st">"Ben"</span>, <span class="st">"Clara"</span>, <span class="st">"Dimitri"</span>, <span class="st">"Emilia-Luise"</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">32</span>, <span class="fl">21</span>, <span class="fl">28</span>, <span class="fl">29</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">students2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Fatima"</span>, <span class="st">"Gerda"</span>, <span class="st">"Hannah"</span>, <span class="st">"Ismail"</span>, <span class="st">"Johanna"</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">32</span>, <span class="fl">21</span>, <span class="fl">28</span>, <span class="fl">29</span><span class="op">)</span>,</span>
<span>  nationality <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DE"</span>, <span class="st">"DE"</span>, <span class="st">"EU"</span>, <span class="st">"International"</span>, <span class="st">"DE"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">exams1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">88</span>, <span class="fl">78</span>, <span class="fl">48</span>, <span class="fl">90</span>, <span class="fl">65</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">exams2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>  score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">68</span>, <span class="fl">34</span>, <span class="fl">95</span>, <span class="fl">83</span>, <span class="fl">79</span>, <span class="fl">23</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Die Datensätze <code>students1</code> und <code>students2</code> beinhalten Daten zu Namen und Alter der Studierenden, in <code>students2</code> haben wir zusätzlich noch die Nationalität. <code>exams1</code> und <code>exams2</code> beinhalten die Prüfungsergebnisse der Studierenden, welche über ihre ID identifiziert werden.</p>
<section id="bind_rows-bind_cols" class="level3" data-number="3.6.1"><h3 data-number="3.6.1" class="anchored" data-anchor-id="bind_rows-bind_cols">
<span class="header-section-number">3.6.1</span> bind_rows() &amp; bind_cols()</h3>
<p>Möchten wir zwei Datensätze zusammenführen, welche die gleichen Informationen (Variablen) für unterschiedliche Beobachtungen beinhalten, verwenden wir <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code>. Damit werden die Zeilen der Datensätze untereinander zusammengefügt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">students2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 4</span></span>
<span><span class="co">#&gt;      id name           age nationality</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1     1 Anna Maria      33 &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 2     2 Ben             32 &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 3     3 Clara           21 &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 4     4 Dimitri         28 &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 5     5 Emilia-Luise    29 &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 6     6 Fatima          33 DE         </span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Die Variable <code>nationality</code> ist nur in <code>students2</code> enthalten. Daher wird diese Variable für Beobachtungen aus <code>students1</code> mit <code>NA</code> befüllt.</p>
<p>Mit <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> werden die Datensätze an den Spalten zusammen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">exams1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span><span class="co">#&gt;   id...1 name           age id...4 score</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1      1 Anna Maria      33      1    88</span></span>
<span><span class="co">#&gt; 2      2 Ben             32      2    78</span></span>
<span><span class="co">#&gt; 3      3 Clara           21      3    48</span></span>
<span><span class="co">#&gt; 4      4 Dimitri         28      6    90</span></span>
<span><span class="co">#&gt; 5      5 Emilia-Luise    29      7    65</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Da die Variable <code>id</code> in beiden Datensätzen enthalten ist, definiert <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> zwei neue Variablen. Die Funktion ist selten sinnvoll, da keine Rücksicht darauf genommen wird, dass die Beobachtungen übereinstimmen. So haben wir hier für Dimitri etwa das Testergebnis einer anderen Person mit <code>id=6</code> hinzugefügt.</p>
<p>Zusätzlich erlaubt <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> nur das Verbinden von Datensätzen mit der selben Zeilenanzahl:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">students2</span>, <span class="va">exams2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in `bind_cols()`:</span></span>
<span><span class="co">#&gt; ! Can't recycle `..1` (size 5) to match `..2` (size 6).</span></span>
<span><span class="co">#&gt; Run `rlang::last_trace()` to see where the error occurred.</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="inner_join-left_join-full_join" class="level3" data-number="3.6.2"><h3 data-number="3.6.2" class="anchored" data-anchor-id="inner_join-left_join-full_join">
<span class="header-section-number">3.6.2</span> inner_join(), left_join(), full_join()</h3>
<p>Im Gegensatz zu <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> ermöglichen die <code>join</code>-Funktionen in <code>dplyr</code>, unterschiedlich gereihte Beobachtungen in zwei Datensätzen korrekt über eine Identifikationsvariable zu verbinden. Diese Funktionen folgen alle dem Syntax <code>..._join(data1, data2, by = "id_var")</code>. Die wichtigsten <code>join</code>- Typen sind <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>.</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> behält wir nur Beobachtungen, die in beiden Datensätzen vorkommen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">exams1</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 4</span></span>
<span><span class="co">#&gt;      id name         age score</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 Anna Maria    33    88</span></span>
<span><span class="co">#&gt; 2     2 Ben           32    78</span></span>
<span><span class="co">#&gt; 3     3 Clara         21    48</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> behält alle Beobachtungen im ersten Datensatz, und ergänzt Informationen aus dem zweiten Datensatz wo verfügbar. Fehlende Werte werden mit <code>NA</code> befüllt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">exams1</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 4</span></span>
<span><span class="co">#&gt;      id name           age score</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 Anna Maria      33    88</span></span>
<span><span class="co">#&gt; 2     2 Ben             32    78</span></span>
<span><span class="co">#&gt; 3     3 Clara           21    48</span></span>
<span><span class="co">#&gt; 4     4 Dimitri         28    NA</span></span>
<span><span class="co">#&gt; 5     5 Emilia-Luise    29    NA</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> wiederum behält alle Beobachtungen aus beiden Datensätzen. Fehlende Werte werden ebenfalls mit <code>NA</code> befüllt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">exams1</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 4</span></span>
<span><span class="co">#&gt;      id name           age score</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 Anna Maria      33    88</span></span>
<span><span class="co">#&gt; 2     2 Ben             32    78</span></span>
<span><span class="co">#&gt; 3     3 Clara           21    48</span></span>
<span><span class="co">#&gt; 4     4 Dimitri         28    NA</span></span>
<span><span class="co">#&gt; 5     5 Emilia-Luise    29    NA</span></span>
<span><span class="co">#&gt; 6     6 &lt;NA&gt;            NA    90</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Wir können die unterschiedlichen Funktionen zum Zusammenführen von Datensätzen auch miteinander verbinden:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">students1</span>, <span class="va">students2</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">exams1</span>, <span class="va">exams2</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"id"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span><span class="co">#&gt;      id name           age nationality score</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     1 Anna Maria      33 &lt;NA&gt;           88</span></span>
<span><span class="co">#&gt; 2     2 Ben             32 &lt;NA&gt;           78</span></span>
<span><span class="co">#&gt; 3     3 Clara           21 &lt;NA&gt;           48</span></span>
<span><span class="co">#&gt; 4     4 Dimitri         28 &lt;NA&gt;           68</span></span>
<span><span class="co">#&gt; 5     5 Emilia-Luise    29 &lt;NA&gt;           34</span></span>
<span><span class="co">#&gt; 6     6 Fatima          33 DE             90</span></span>
<span><span class="co">#&gt; # ℹ 4 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="datensatz-umformen" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="datensatz-umformen">
<span class="header-section-number">3.7</span> Datensatz umformen</h2>
<p>Zu Beginn von <a href="#sec-daten-transform" class="quarto-xref"><span>Kapitel 3</span></a> haben wir die Prinzipien von <em>Tidy Data Sets</em> aufgeführt: Jede Zeile ist eine Beobachtung, jede Spalte eine Variable, und jeder Wert in einer eigenen Zelle. In der Praxis sind Datensätze jedoch häufig nicht im <em>Tidy Data</em>-Format. Der Datensatz <code>educ_wide</code> zeigt den Zeitverlauf der durchschnittlichen PISA-Ergebnisse (Lesen) für acht europäische Länder, basierend auf <a href="https://databank.worldbank.org/">Daten der Weltbank</a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">educ_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AUT"</span>,<span class="st">"DEU"</span>,<span class="st">"ITA"</span>,<span class="st">"NLD"</span>,<span class="st">"NOR"</span>,<span class="st">"POL"</span>,<span class="st">"ROU"</span>,<span class="st">"GBR"</span><span class="op">)</span>,</span>
<span>  `2009` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">470.3</span>, <span class="fl">497.3</span>, <span class="fl">486.1</span>, <span class="fl">508.4</span>, <span class="fl">503.2</span>, <span class="fl">500.5</span>, <span class="fl">424.5</span>, <span class="fl">494.2</span><span class="op">)</span>,</span>
<span>  `2012` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">489.6</span>, <span class="fl">507.7</span>, <span class="fl">489.8</span>, <span class="fl">511.2</span>, <span class="fl">503.9</span>, <span class="fl">518.2</span>, <span class="fl">437.6</span>, <span class="fl">499.3</span><span class="op">)</span>,</span>
<span>  `2015` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">484.9</span>, <span class="fl">509.1</span>, <span class="fl">484.8</span>, <span class="fl">503.0</span>, <span class="fl">513.2</span>, <span class="fl">505.7</span>, <span class="fl">433.6</span>, <span class="fl">498.0</span><span class="op">)</span>,</span>
<span>  `2018` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">484.4</span>, <span class="fl">498.3</span>, <span class="fl">476.3</span>, <span class="fl">484.8</span>, <span class="fl">499.5</span>, <span class="fl">511.9</span>, <span class="fl">427.7</span>, <span class="fl">503.9</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">educ_wide</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 5</span></span>
<span><span class="co">#&gt;   country `2009` `2012` `2015` `2018`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 AUT       470.   490.   485.   484.</span></span>
<span><span class="co">#&gt; 2 DEU       497.   508.   509.   498.</span></span>
<span><span class="co">#&gt; 3 ITA       486.   490.   485.   476.</span></span>
<span><span class="co">#&gt; 4 NLD       508.   511.   503    485.</span></span>
<span><span class="co">#&gt; 5 NOR       503.   504.   513.   500.</span></span>
<span><span class="co">#&gt; 6 POL       500.   518.   506.   512.</span></span>
<span><span class="co">#&gt; # ℹ 2 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Die Daten sind im <em>wide-Format</em>: Jede Zeile beinhaltet mehrere Beobachtungen. In unserem Beispiel haben wir in jeder Zeile für ein bestimmtes Land die Lese-Ergebnisse für die PISA-Tests von 2009 bis 2018.</p>
<p>Ebenfalls gebräuchlich bei öffentlichen Statistiken ist das <em>long-Format</em>: Hier beinhalten Spalten Informationen zu mehr als einer Variable. Der Datensatz <code>educ_long</code> beinhaltet Daten aus dem Jahr 2018 für die selben europäischen Länder, mit den durchschnittlichen PISA-Scores in Lesen (<code>pisa_reading</code>), Mathematik (<code>pisa_math</code>) und Naturwissenschaft (<code>pisa_science</code>), wieder basierend auf <a href="https://databank.worldbank.org/">Daten der Weltbank</a>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">educ_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AUT"</span>,<span class="st">"DEU"</span>,<span class="st">"ITA"</span>,<span class="st">"NLD"</span>,<span class="st">"NOR"</span>,<span class="st">"POL"</span>,<span class="st">"ROU"</span>,<span class="st">"GBR"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2018</span>,</span>
<span>  indicator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pisa_reading"</span>,<span class="st">"pisa_math"</span>,<span class="st">"pisa_science"</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">484.4</span>, <span class="fl">498.9</span>, <span class="fl">489.8</span>,  <span class="co"># AUT</span></span>
<span>    <span class="fl">498.3</span>, <span class="fl">500.0</span>, <span class="fl">503.0</span>,  <span class="co"># DEU</span></span>
<span>    <span class="fl">476.3</span>, <span class="fl">486.6</span>, <span class="fl">468.0</span>,  <span class="co"># ITA</span></span>
<span>    <span class="fl">484.8</span>, <span class="fl">519.2</span>, <span class="fl">503.4</span>,  <span class="co"># NLD</span></span>
<span>    <span class="fl">499.5</span>, <span class="fl">501.0</span>, <span class="fl">490.4</span>,  <span class="co"># NOR</span></span>
<span>    <span class="fl">511.9</span>, <span class="fl">515.6</span>, <span class="fl">511.0</span>,  <span class="co"># POL</span></span>
<span>    <span class="fl">427.7</span>, <span class="fl">429.9</span>, <span class="fl">425.8</span>,  <span class="co"># ROU</span></span>
<span>    <span class="fl">503.9</span>, <span class="fl">501.8</span>, <span class="fl">504.7</span>   <span class="co"># GBR</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">educ_long</span></span>
<span><span class="co">#&gt; # A tibble: 24 × 4</span></span>
<span><span class="co">#&gt;   country  year indicator    value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 AUT      2018 pisa_reading  484.</span></span>
<span><span class="co">#&gt; 2 AUT      2018 pisa_math     499.</span></span>
<span><span class="co">#&gt; 3 AUT      2018 pisa_science  490.</span></span>
<span><span class="co">#&gt; 4 DEU      2018 pisa_reading  498.</span></span>
<span><span class="co">#&gt; 5 DEU      2018 pisa_math     500 </span></span>
<span><span class="co">#&gt; 6 DEU      2018 pisa_science  503 </span></span>
<span><span class="co">#&gt; # ℹ 18 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In diesem Fall gibt uns die Variable <code>indicator</code> die Information, auf welche Kennzahl sich die Zahl in der Variable <code>value</code> bezieht.</p>
<p>Anhand dieser beiden Datensätze werden wir nun die <code>dplyr</code> Funktionen <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> und <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> kennenlernen. Das Umformen von Datensätzen kann etwas knifflig sein, hier werden wir nur die Basics besprechen. Für mehr Details, siehe <a href="https://r4ds.hadley.nz/data-tidy.html">Kapitel 5 in R for Data Science</a>.</p>
<section id="pivot_longer" class="level3" data-number="3.7.1"><h3 data-number="3.7.1" class="anchored" data-anchor-id="pivot_longer">
<span class="header-section-number">3.7.1</span> pivot_longer()</h3>
<p>Um einen Datensatz vom <em>wide-Format</em> ins <em>tidy-Format</em> zu bekommen (oder auch um einen <em>tidy</em> Datensatz in <em>long-Format</em> umzuwandeln), verwenden wir <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. Dieser Befehl folgt dem Syntax <code>dataset |&gt; pivot_longer(cols = ..., names_to = ..., values_to = ...)</code>.</p>
<p><a href="#fig-pivot-longer" class="quarto-xref">Abbildung&nbsp;<span>3.1</span></a> skizziert die Idee von <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> am Beispiel des <code>educ_wide</code> Datensatzes. Die Länder-Spalte, welche auch im <em>long-Format</em> übernommen werden soll, muss einmal pro pivotierter Spalte wiederholt werden (grün markiert). Die orange markierten Spalten werden pivotiert, diese müssen als <code>col = ...</code> spezifiziert werden. Diese finden sich im <em>long-Format</em> in der Spalte <code>year</code> wieder, deren Namen wir mit der Option <code>names_to = ...</code> definieren. Die jeweiligen Werte in den zu pivotierenden Spalten (türkis markiert) werden in die zweite neue Spalte <code>pisa_reading</code> pivotiert, deren Namen wir mit der Option <code>values_to = ...</code> definieren.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pivot-longer" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Skizzierung der Grundidee von pivot_longer().">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pivot-longer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pivot_longer.png" class="img-fluid figure-img" alt="Skizzierung der Grundidee von pivot_longer().">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pivot-longer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;3.1: Grundidee von pivot_longer().
</figcaption></figure>
</div>
</div>
</div>
<p>Um also den Datensatz <code>educ_wide</code> ins <em>tidy</em>-Format zu bringen, schreiben wir:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">educ_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">`2009`</span><span class="op">:</span><span class="va">`2018`</span>, <span class="co"># alternativ: cols = !country</span></span>
<span>    names_to <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"pisa_reading"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 32 × 3</span></span>
<span><span class="co">#&gt;   country year  pisa_reading</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 AUT     2009          470.</span></span>
<span><span class="co">#&gt; 2 AUT     2012          490.</span></span>
<span><span class="co">#&gt; 3 AUT     2015          485.</span></span>
<span><span class="co">#&gt; 4 AUT     2018          484.</span></span>
<span><span class="co">#&gt; 5 DEU     2009          497.</span></span>
<span><span class="co">#&gt; 6 DEU     2012          508.</span></span>
<span><span class="co">#&gt; # ℹ 26 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nun haben einen Datensatz, bei dem jede Reihe mit einer Beobachtung (Land-Jahr-Kombination) korrespondiert. Der Datensatz ist somit im <em>tidy-Format</em>.</p>
</section><section id="pivot_wider" class="level3" data-number="3.7.2"><h3 data-number="3.7.2" class="anchored" data-anchor-id="pivot_wider">
<span class="header-section-number">3.7.2</span> pivot_wider()</h3>
<p>Um einen Datensatz vom <em>long-Format</em> ins <em>tidy-Format</em> zu bekommen (oder auch um einen <em>tidy</em> Datensatz in <em>wide-Format</em> umzuwandeln), verwenden wir <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>. Dieser Befehl folgt dem Syntax <code>dataset |&gt; pivot_wider(id_cols = ..., names_from = ..., values_from = ...)</code>.</p>
<p><a href="#fig-pivot-wider" class="quarto-xref">Abbildung&nbsp;<span>3.2</span></a> skizziert die Idee von <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> am Beispiel des <code>educ_wide</code> Datensatzes. Die Länder- und Jahres-Spalten, welche auch im <em>wide-Format</em> übernommen werden sollen, identifizieren nun die einzelnen Beobachtungen (grün markiert). Die Variablennamen der neuen Spalten <code>pisa_reading</code> und <code>pisa_math</code> werden der Spalte <code>indicator</code> entnommen, welche wir mit <code>names_from = ...</code> definieren. Die Werte in diesen beiden Spalten stammen aus der Spalte <code>value</code> im Original-Datensatz, diese definieren wir mit <code>values_from = ...</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pivot-wider" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Skizzierung der Grundidee von pivot_wider().">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-pivot-wider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pivot_wider.png" class="img-fluid figure-img" alt="Skizzierung der Grundidee von pivot_wider().">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pivot-wider-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;3.2: Grundidee von pivot_wider().
</figcaption></figure>
</div>
</div>
</div>
<p>Um also den Datensatz <code>educ_long</code> ins <em>tidy</em>-Format zu bringen, schreiben wir:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">educ_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span></span>
<span>    id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span>,</span>
<span>    names_from <span class="op">=</span> <span class="va">indicator</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 5</span></span>
<span><span class="co">#&gt;   country  year pisa_reading pisa_math pisa_science</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 AUT      2018         484.      499.         490.</span></span>
<span><span class="co">#&gt; 2 DEU      2018         498.      500          503 </span></span>
<span><span class="co">#&gt; 3 ITA      2018         476.      487.         468 </span></span>
<span><span class="co">#&gt; 4 NLD      2018         485.      519.         503.</span></span>
<span><span class="co">#&gt; 5 NOR      2018         500.      501          490.</span></span>
<span><span class="co">#&gt; 6 POL      2018         512.      516.         511 </span></span>
<span><span class="co">#&gt; # ℹ 2 more rows</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section></section><section id="weitere-themen" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="weitere-themen">
<span class="header-section-number">3.8</span> Weitere Themen</h2>
<section id="strings-und-regular-expressions" class="level3" data-number="3.8.1"><h3 data-number="3.8.1" class="anchored" data-anchor-id="strings-und-regular-expressions">
<span class="header-section-number">3.8.1</span> Strings und Regular Expressions</h3>
<p>Beim Arbeiten mit Daten in R begegnen uns oft Text- oder Zeichenkettenvariablen, die wir bereinigen, filtern oder transformieren möchten. Mit <code>dplyr</code> in Kombination mit Funktionen aus <code>stringr</code> können wir Strings gezielt manipulieren, Muster erkennen und ersetzen oder neue Variablen auf Basis von Textinhalten erstellen. Besonders mächtig werden solche Operationen durch Regular Expressions, mit denen komplexe Such- und Ersetzungsregeln präzise umgesetzt werden können.</p>
<p>Das Arbeiten mit Strings und Regular Expressions wird in diesem Kurs jedoch nicht thematisiert. Für mehr Informationen zu diesen Themen, siehe <a href="https://r4ds.hadley.nz/strings.html">Kapitel 14</a> und <a href="https://r4ds.hadley.nz/regexps.html">Kapitel 15</a> in R for Data Science.</p>
</section><section id="datum-und-zeit" class="level3" data-number="3.8.2"><h3 data-number="3.8.2" class="anchored" data-anchor-id="datum-und-zeit">
<span class="header-section-number">3.8.2</span> Datum und Zeit</h3>
<p>Im wirtschaftswissenschaftlichen Kontext enthalten Datensätze häufig Zeitinformationen, etwa Beobachtungszeitpunkte, Monats- oder Jahreswerte von Finanz- oder Konjunkturindikatoren. In R lassen sich diese mit Packages wie <code>lubridate</code> und <code>dplyr</code> gezielt verarbeiten, um Datums- und Zeitangaben zu extrahieren, zu transformieren oder für Analysen zu aggregieren. Komplexere Operationen wie Zeitreihenanalysen oder Kalenderberechnungen sind besonders nützlich, um Trends, saisonale Muster oder zeitabhängige Zusammenhänge zu erkennen.</p>
<p>Das Arbeiten mit Datum und Zeit wird in diesem Kurs jedoch nicht vertieft. Für weiterführende Informationen siehe <a href="https://r4ds.hadley.nz/datetimes.html">Kapitel 17 in R for Data Science</a>.</p>
</section><section id="fehlende-werte" class="level3" data-number="3.8.3"><h3 data-number="3.8.3" class="anchored" data-anchor-id="fehlende-werte">
<span class="header-section-number">3.8.3</span> Fehlende Werte</h3>
<p>Fehlende Werte (<code>NA</code>) sind in wirtschaftswissenschaftlichen Datensätzen häufig anzufinden, z.B. bei unvollständigen Befragungen, unregelmäßigen Meldungen oder Ausreißern, die nicht berichtet wurden. In R lassen sich diese gezielt identifizieren, ersetzen oder imputieren, um analysenfreundliche Datensätze zu erstellen, ohne die Aussagekraft zu verlieren. Solche Techniken sind besonders wichtig, um Verzerrungen zu vermeiden und robuste statistische Ergebnisse zu erzielen.</p>
<p>Bisher haben wir uns nur damit befasst, wie wir fehlende Werte mittels <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> ausschließen. Für andere Möglichkeiten im Umgang mit fehlenden Werten, siehe <a href="https://r4ds.hadley.nz/missing-values.html">Kapitel 18 in R for Data Science</a>.</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopiert");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopiert");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./best_practices.html" class="pagination-link" aria-label="Best Practices">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Best Practices</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./daten_import.html" class="pagination-link" aria-label="Daten importieren">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Daten importieren</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>